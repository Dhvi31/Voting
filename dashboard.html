<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voter Dashboard | VoteVibes</title>
  <link rel="stylesheet" href="dashboard.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<!-- Navbar -->
<header class="navbar">
  <div class="logo"><i class="fa-solid fa-dove"></i> VoteVibes</div>
  <ul class="nav-links"></ul>

  <div class="nav-actions">
    <div class="profile-menu">
      <img id="profilePic" class="profile-icon" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="Profile" />
      <div class="dropdown hidden">
        <a href="profile.html"><i class="fa-solid fa-user"></i> Profile</a>
        <a onclick="logoutUser()"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
      </div>
    </div>
  </div>
</header>

<!-- Welcome -->
<section class="welcome">
  <h2>Welcome, <span id="voterName">Voter</span> üëã</h2>
  <p>Your participation makes democracy stronger!</p>
</section>

<!-- Dashboard -->
<main class="features">

  <!-- Active Elections Summary -->
  <div class="card" id="activeElectionsCard">
    <h3>Active Elections</h3>
    <p id="activeElectionText">Loading your election data...</p>
    <a href="active.html" id="voteBtn" class="small-btn">View & Vote</a>
  </div>

  <!-- Upcoming Elections -->
  <div class="card">
    <h3>Upcoming Elections</h3>
    <p>You have <strong>1 upcoming election</strong> to vote in.</p>
    <a href="upcoming.html" class="small-btn">View Elections</a>
  </div>

  <!-- Results -->
  <div class="card">
    <h3>Election Results</h3>
    <p>Check the latest election outcomes.</p>
    <a href="result.html" class="small-btn">View Results</a>
  </div>

  <!-- Voting History -->
  <div class="card" id="votingHistoryCard">
    <h3>Voting History</h3>
    <div id="votingHistoryList">
      <p>Loading your voting record...</p>
    </div>
  </div>

</main>

<!-- Footer -->
<footer class="site-footer">
  <div class="footer-content">
    <div>
      <h4>About VoteVibes</h4>
      <p>Secure online voting platform for students.</p>
    </div>
    <div>
      <h4>Links</h4>
      <ul>
        <li><a href="active.html">Active Elections</a></li>
        <li><a href="upcoming.html">Upcoming</a></li>
        <li><a href="result.html">Results</a></li>
      </ul>
    </div>
    <div>
      <h4>Contact</h4>
      <ul>
        <li>Email: support@votevibes.com</li>
      </ul>
    </div>
  </div>
  <div class="footer-bottom">&copy; 2025 VoteVibes. All Rights Reserved.</div>
</footer>
<style>
  /* ===== Profile Icon Styling ===== */
.profile-icon {
  width: 45px;                /* Normal size */
  height: 45px;
  border-radius: 50%;         /* Makes it perfectly circular */
  object-fit: cover;          /* Keeps image ratio correct */
  border: 2px solid #fff;     /* Optional white outline for nice look */
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15); /* Soft shadow */
  cursor: pointer;            /* Looks clickable */
  transition: transform 0.2s ease;
}

.profile-icon:hover {
  transform: scale(1.05);     /* Small zoom on hover */
}
</style>

<script>
/* ===== Navbar Dropdown ===== */
const profileIcon = document.querySelector(".profile-icon");
const dropdown = document.querySelector(".dropdown");
profileIcon.addEventListener("click", (e) => {
  dropdown.classList.toggle("hidden");
  e.stopPropagation();
});
document.addEventListener("click", (e) => {
  if (!dropdown.contains(e.target)) dropdown.classList.add("hidden");
});

/* ===== User Data ===== */
window.onload = function () {
  const user = JSON.parse(localStorage.getItem("user"));

  if (user) {
    document.getElementById("voterName").innerText = user.name || "Voter";
    if (user.picture) {
      document.getElementById("profilePic").src = user.picture;
    }
  } else {
    document.getElementById("voterName").innerText = "Voter";
  }
};

/* ===== Active Elections ===== */
const elections = [
  { name: "Student Council Election 2025", isActive: true },
  { name: "Sports Captain Election 2025", isActive: true },
  { name: "Library Committee Election", isActive: false }
];

const activeElections = elections.filter(e => e.isActive);
const activeCount = activeElections.length;

const electionText = document.getElementById("activeElectionText");
const voteBtn = document.getElementById("voteBtn");

if (activeCount === 0) {
  electionText.innerHTML = "No active elections at the moment.";
  voteBtn.style.display = "none";
} else {
  if (!user) {
    electionText.innerHTML = `You have <strong>${activeCount}</strong> active election${activeCount > 1 ? "s" : ""}. Please <a href="login.html">log in</a> to vote.`;
  } else {
    // Count how many active elections user has voted in
    const votes = user.votes || [];
    const votedCount = votes.filter(v => activeElections.some(e => e.name === v.election)).length;

    if (votedCount === activeCount) {
      electionText.innerHTML = `‚úÖ You‚Äôve voted in all <strong>${activeCount}</strong> active election${activeCount > 1 ? "s" : ""}.`;
      voteBtn.innerText = "View Active Elections";
    } else if (votedCount > 0) {
      electionText.innerHTML = `üü° You‚Äôve voted in <strong>${votedCount}</strong> of <strong>${activeCount}</strong> active election${activeCount > 1 ? "s" : ""}.`;
      voteBtn.innerText = "Continue Voting";
    } else {
      electionText.innerHTML = `üü¢ There ${activeCount > 1 ? "are" : "is"} <strong>${activeCount}</strong> active election${activeCount > 1 ? "s" : ""} available.`;
      voteBtn.innerText = "Go to Active Elections";
    }
  }
}

/* ===== Voting History ===== */
const historyList = document.getElementById("votingHistoryList");

if (user?.votes && user.votes.length > 0) {
  historyList.innerHTML = user.votes.map(v => `
    <div class="history-item">
      <p><strong>${v.election}</strong></p>
      <p>üó≥Ô∏è You voted for: <b>${v.candidate}</b></p>
      <p><small>${v.date}</small></p>
      <hr>
    </div>
  `).join("");
} else {
  historyList.innerHTML = "<p>You haven‚Äôt voted in any elections yet.</p>";
}

/* ===== Logout ===== */
function logoutUser() {
  localStorage.removeItem("user");
  window.location.href = "login.html";
}
</script>

<style>
.history-item {
  margin-bottom: 10px;
  padding: 5px 0;
  color: #333;
}
.history-item hr {
  border: none;
  border-bottom: 1px solid #eee;
  margin-top: 5px;
}
</style>

</body>
</html>
