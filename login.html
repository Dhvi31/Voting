<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login | VoteVibes</title>
  <link rel="stylesheet" href="./login.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    /* ===== Google Button Styling ===== */
    .google-signin {
      display: flex;
      justify-content: center;
      margin-top: 15px;
    }

    #g_id_signin {
      width: 100%;
    }

    .google-btn-wrapper {
      width: 100%;
    }

    .custom-google-btn {
      width: 100%;
      background-color: white;
      border: 2px solid black; /* ðŸ”¥ Changed border to black */
      border-radius: 6px;
      padding: 10px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      color: #222;
      transition: 0.3s;
    }

    .custom-google-btn:hover {
      background-color: #f2f2f2;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    .custom-google-btn img {
      width: 20px;
      height: 20px;
    }
  </style>
</head>
<body>
  <!-- ===== Navbar ===== -->
  <nav class="navbar">
    <div class="logo"><i class="fa-solid fa-dove"></i> VoteVibes</div>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="upcoming.html">Upcoming Elections</a></li>
      <li><a href="register.html">Election Registration</a></li>
    </ul>
  </nav>

  <!-- ===== Main Content ===== -->
  <main>
    <div class="form-container">
      <h2>Login</h2>

      <form id="loginForm">
        <label for="identifier">Roll Number / Admin ID / Email</label>
        <input type="text" id="identifier" placeholder="Enter Roll Number, Admin ID, or Email" required>

        <label for="password">Password</label>
        <div class="password-container">
          <input type="password" id="password" placeholder="Enter your password" required>
          <i class="fa-solid fa-eye" id="togglePassword"></i>
        </div>

        <div class="forgot-link">
          <a href="forgot.html">Forgot Password?</a>
        </div>

        <!-- Hidden OTP container -->
        <div id="otpContainer">
          <label>Enter OTP</label>
          <input type="text" id="otp" placeholder="Enter OTP">
        </div>

        <button type="button" class="btn btn-secondary" id="sendOtpBtn">Send OTP</button>
        <button type="submit" class="btn btn-primary">Login</button>
      </form>

      <!-- Divider -->
      <div class="divider" style="text-align:center; margin:20px 0; position:relative;">
        <span style="background:#fff; padding:0 10px; color:#666;">OR</span>
        <hr style="position:absolute; top:50%; left:0; width:100%; border:none; border-top:1px solid #ccc; z-index:-1;">
      </div>

      <!-- Google Sign-In (Custom Button) -->
      <div class="google-signin">
        <div class="google-btn-wrapper">
          <div class="custom-google-btn" id="googleCustomBtn">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo">
            <span>Continue with Google</span>
          </div>
        </div>
      </div>

      <!-- Hidden default Google sign-in element -->
      <div id="g_id_signin" style="display:none;"></div>
    </div>
  </main>

  <!-- ===== Footer ===== -->
  <footer class="site-footer">
    <p>Â© 2025 VoteVibes. All Rights Reserved.</p>
  </footer>

  <!-- ===== Scripts ===== -->
  <script>
    const sendOtpBtn = document.getElementById('sendOtpBtn');
    const otpContainer = document.getElementById('otpContainer');
    const togglePassword = document.getElementById('togglePassword');
    const passwordField = document.getElementById('password');
    const loginForm = document.getElementById('loginForm');

    sendOtpBtn.addEventListener('click', () => {
      otpContainer.classList.add('show');
      sendOtpBtn.disabled = true;
      sendOtpBtn.innerText = 'OTP Sent';
    });

    togglePassword.addEventListener('click', () => {
      const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordField.setAttribute('type', type);
      togglePassword.classList.toggle('fa-eye');
      togglePassword.classList.toggle('fa-eye-slash');
    });

    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const id = document.getElementById('identifier').value.trim();
      const pass = passwordField.value.trim();

      if (!id || !pass) {
        alert('Please fill all fields.');
        return;
      }

      if (id.toLowerCase() === 'iit2024028' && pass === 'admin123') {
        alert('Admin login successful!');
        window.location.href = 'admin.html';
      } else {
        alert('Login successful!');
        window.location.href = 'dashboard.html';
      }
    });
  </script>

  <!-- ===== Google Sign-In ===== -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script>
    window.onload = function() {
      const CLIENT_ID = "970706649931-jh3jhoqe03b5dnv2ctj4jemf7fsbbbr5.apps.googleusercontent.com";

      if (window.google && google.accounts && google.accounts.id) {
        google.accounts.id.initialize({
          client_id: CLIENT_ID,
          callback: handleCredentialResponse
        });

        google.accounts.id.renderButton(
          document.getElementById("g_id_signin"),
          { theme: "outline", size: "large", width: 320 }
        );

        document.getElementById("googleCustomBtn").addEventListener("click", () => {
          google.accounts.id.prompt();
        });
      } else {
        console.warn('Google Identity Services not loaded yet.');
      }
    };

    function handleCredentialResponse(response) {
      const jwt = response.credential;
      try {
        const base64Url = jwt.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        const jsonPayload = decodeURIComponent(atob(base64).split('').map(c =>
          '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
        ).join(''));
        const user = JSON.parse(jsonPayload);
        console.log("Google User Info:", user);
        window.location.href = "dashboard.html";
      } catch (err) {
        console.error('Failed to decode Google credential', err);
      }
    }
  </script>
</body>
</html>
